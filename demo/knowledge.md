# 🚗 路径规划与控制 - 核心知识点

## 第一章：路径规划基础

### 1.1 什么是路径规划？
路径规划是让智能车找到从起点到终点的最优路线，就像导航软件帮你找路一样。

**核心任务**：
- 找到最短或最优路径
- 避开障碍物
- 保证路径平滑可行

### 1.2 常用规划算法

#### A* 算法
- **原理**：结合实际代价和启发式估计，优先探索最有希望的方向
- **优点**：能找到最短路径，速度快，应用最广
- **公式**：f(n) = g(n) + h(n)
  - g(n)：从起点到当前点的实际代价
  - h(n)：从当前点到终点的估计代价

#### Dijkstra 算法
- **原理**：像水波扩散，找到所有点的最短路径
- **优点**：一定能找到最优解
- **缺点**：搜索范围大，速度较慢

#### RRT 算法（快速随机树）
- **原理**：随机采样生成树枝状路径
- **优点**：适合高维复杂空间
- **应用**：机器人臂、无人机路径规划

### 1.3 规划性能评估
- **路径长度**：越短越好
- **计算时间**：越快越好
- **平滑度**：转弯角度小，易于跟踪

---

## 第二章：轨迹跟踪控制

### 2.1 什么是轨迹跟踪？
轨迹跟踪是让车辆精确地沿着规划好的路径行驶，类似让车沿着画好的线走。

**关键挑战**：
- 车辆会偏离路径
- 转弯时易产生误差
- 速度变化影响控制效果

### 2.2 控制误差

#### CTE（横向偏差）
- **定义**：车辆到路径的垂直距离
- **单位**：米（m）
- **计算**：路径切线方向的垂直投影
- **理想值**：接近0
- **评价标准**：
  - 平均CTE < 0.3m：优秀
  - 最大CTE < 1.5m：合格

#### 航向误差
- **定义**：车头方向与目标方向的角度差
- **单位**：度（°）或弧度（rad）
- **理想值**：接近0
- **评价标准**：< 15°为良好

---

## 第三章：PID控制器

### 3.1 PID原理

PID由三个部分组成，协同工作实现精确控制：

#### P（比例控制）Proportional
- **作用**：根据当前偏差大小决定控制力度
- **特点**：偏差越大，控制输出越大
- **参数Kp**：
  - 过小：反应慢，偏差大，跟踪不及时
  - 过大：振荡，左右摇摆，不稳定
  - 合适：快速响应，适度纠偏

#### I（积分控制）Integral
- **作用**：消除长期累积的稳态误差
- **特点**：记忆过去误差，逐步补偿
- **参数Ki**：
  - 过小：存在稳态误差，无法完全消除偏差
  - 过大：积分饱和，超调严重
  - 合适：平滑消除稳态误差

#### D（微分控制）Derivative
- **作用**：预测误差变化趋势，抑制超调
- **特点**：阻尼作用，相当于刹车
- **参数Kd**：
  - 过小：超调大，振荡明显
  - 过大：对噪声敏感，抖动
  - 合适：有效抑制超调，提高稳定性

### 3.2 PID控制公式

```
输出 = Kp × 偏差 + Ki × ∫偏差dt + Kd × d偏差/dt
```

对于路径跟踪：
```
转向角速度 = - (Kp × CTE + Ki × ∫CTE·dt + Kd × dCTE/dt) + 航向增益 × 航向误差
```

### 3.3 PID参数调节

#### 经典参数组合

| 类型 | Kp | Ki | Kd | 速度 | 特点 |
|------|----|----|-------|-------|------|
| **保守型** | 0.6 | 0.01 | 0.4 | 0.6 m/s | 稳定优先，不易振荡 |
| **平衡型** | 1.0 | 0.03 | 0.5 | 0.8 m/s | 响应与稳定兼顾 |
| **激进型** | 1.5 | 0.05 | 0.3 | 1.0 m/s | 快速响应，可能振荡 |
| **缓慢型** | 0.8 | 0.02 | 0.6 | 0.4 m/s | 低速高精度 |

#### 调参原则

1. **先调Kp**：从小到大，直到快速响应但不振荡
2. **再调Ki**：逐步增加，消除稳态误差
3. **最后调Kd**：增加阻尼，抑制振荡
4. **调整速度**：速度越慢，越容易控制

### 3.4 常见控制问题

#### 振荡问题
- **现象**：车辆左右摇摆
- **原因**：Kp过大，速度过快
- **解决**：降低Kp，增加Kd，降低速度

#### 稳态误差
- **现象**：始终有偏差，无法完全对准
- **原因**：Ki太小或为0
- **解决**：增加Ki，设置积分限幅

#### 超调
- **现象**：转过头又转回来
- **原因**：Kd太小，Kp太大
- **解决**：增加Kd，适当降低Kp

#### 响应慢
- **现象**：转弯跟不上
- **原因**：Kp太小
- **解决**：增大Kp，增加前视距离

---

## 第四章：运动学模型

### 4.1 自行车模型（类车模型）

智能车常用的简化运动模型：

**状态方程**：
```
x' = v × cos(θ)     // X方向速度
y' = v × sin(θ)     // Y方向速度  
θ' = ω              // 角速度（转向速率）
```

**参数说明**：
- **v**：前进速度（m/s）
- **ω**：角速度（rad/s），控制转向快慢
- **θ**：车头朝向角度（弧度）
- **dt**：控制周期（通常50ms = 0.05s）

### 4.2 离散更新

每个控制周期更新状态：
```
θ(t+1) = θ(t) + ω × dt
x(t+1) = x(t) + v × cos(θ) × dt
y(t+1) = y(t) + v × sin(θ) × dt
```

---

## 第五章：坐标系统

### 5.1 地图坐标系
- **X轴**：水平方向（向右为正）
- **Y轴**：垂直方向（向下为正）
- **原点**：地图左上角 (0, 0)

### 5.2 车辆状态
- **位置**：(x, y) 坐标
- **朝向**：θ 角度
  - 0° / 0 rad：向右
  - 90° / π/2 rad：向下
  - 180° / π rad：向左
  - 270° / 3π/2 rad：向上

### 5.3 角度归一化
保持角度在 [-π, π] 范围内：
```
while θ > π:  θ -= 2π
while θ < -π: θ += 2π
```

---

## 第六章：前视控制（Pure Pursuit）

### 6.1 原理

不跟踪最近点，而是跟踪前方一定距离的"前视点"：

**步骤**：
1. 找到车辆最近的路径点
2. 从最近点沿路径前进固定距离（如3米）
3. 计算到前视点的CTE和航向误差
4. 用PID控制跟踪前视点

### 6.2 前视距离选择

- **太短**：频繁调整，易振荡
- **太长**：反应慢，切弯
- **推荐**：3-5米，或根据速度动态调整

### 6.3 动态前视距离
```
前视距离 = 基础距离 + k × 速度
例如：lookahead = 2.0 + 1.5 × v
```

---

## 第七章：性能评估

### 7.1 规划指标
- **路径长度**：越短越好（但要考虑可行性）
- **计算时间**：实时性要求，通常<100ms
- **搜索节点数**：算法效率，越少越好
- **平滑度**：连续性，转角变化小

### 7.2 控制指标
- **平均CTE**：< 0.3m 优秀，< 0.5m 良好
- **最大CTE**：< 1.5m 合格，< 1.0m 优秀
- **平均航向误差**：< 15° 良好，< 10° 优秀
- **超调量**：< 10% 稳定
- **稳态误差**：< 0.1m
- **调节时间**：到达稳定状态的时间

---

## 第八章：实践技巧

### 8.1 参数调优流程

1. **初始保守参数**：Kp=0.5, Ki=0, Kd=0.3
2. **增大Kp**：直到出现轻微振荡
3. **回退Kp**：降低到稳定值
4. **增加Ki**：消除稳态误差
5. **调整Kd**：抑制振荡，提高稳定性
6. **优化速度**：在保证精度前提下提高速度

### 8.2 调试方法

- **观察轨迹**：是否平滑跟踪路径
- **查看CTE图表**：波动是否合理
- **分析航向误差**：是否快速收敛
- **记录统计数据**：量化评估性能
- **对比不同参数**：找到最优组合

### 8.3 常见错误

❌ **只调Kp**：忽略Ki和Kd的作用
❌ **参数过大**：追求快速反应导致振荡
❌ **速度过快**：控制来不及反应
❌ **忽略积分限幅**：积分饱和导致超调
❌ **不看数据**：凭感觉调参，效率低

---

## 知识总结

### 必须掌握的核心概念

✅ **路径规划**：找到从起点到终点的最优路径
✅ **轨迹跟踪**：让车辆精确沿路径行驶
✅ **CTE**：横向偏差，垂直距离
✅ **PID三要素**：比例、积分、微分
✅ **参数调节**：理解每个参数的作用
✅ **性能评估**：用数据量化控制效果

### 实践技能

✅ 能够选择合适的规划算法
✅ 能够调节PID参数
✅ 能够分析控制误差图表
✅ 能够对比不同参数效果
✅ 能够诊断常见控制问题

---

## 学习路径

1. **理解原理** → 2. **观察演示** → 3. **动手调参** → 4. **分析数据** → 5. **总结规律**

坚持练习，你会掌握路径规划与控制的精髓！🚀