<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è·¯å¾„è§„åˆ’ä¸æ§åˆ¶çŸ¥è¯†æµ‹éªŒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        /* ç™»å½•é¡µé¢ */
        .login-page {
            text-align: center;
        }

        .login-page input {
            width: 100%;
            max-width: 300px;
            padding: 15px;
            font-size: 18px;
            border: 2px solid #667eea;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ç­”é¢˜é¡µé¢ */
        .quiz-page {
            display: none;
        }

        .quiz-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 10px;
        }

        .quiz-info div {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
        }

        .timer {
            color: #e74c3c;
        }

        .question-card {
            background: #f9f9f9;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
        }

        .question-number {
            color: #667eea;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
            line-height: 1.6;
        }

        .options {
            list-style: none;
        }

        .option {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px 20px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f0ff;
        }

        .option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .option.correct {
            border-color: #27ae60;
            background: #27ae60;
            color: white;
        }

        .option.wrong {
            border-color: #e74c3c;
            background: #e74c3c;
            color: white;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn-secondary {
            background: #95a5a6;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        /* ç»“æœé¡µé¢ */
        .result-page {
            display: none;
            text-align: center;
        }

        .score-display {
            font-size: 72px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 30px 0;
        }

        .result-info {
            font-size: 24px;
            color: #666;
            margin: 20px 0;
        }

        .leaderboard {
            margin-top: 40px;
            text-align: left;
        }

        .leaderboard h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            transition: background 0.2s;
        }

        .leaderboard-item:hover {
            background: #f5f5f5;
        }

        .leaderboard-item.me {
            background: #fff4e6;
            font-weight: bold;
        }

        .rank {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            min-width: 50px;
        }

        .rank.gold { color: #f39c12; }
        .rank.silver { color: #95a5a6; }
        .rank.bronze { color: #cd7f32; }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }

        .explanation {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            background: #f0f7ff;
            border-left: 4px solid #667eea;
            display: none;
        }

        .explanation.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .explanation-title {
            font-size: 16px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .explanation-content {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
        }

        .result-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .result-indicator.correct {
            background: #27ae60;
            color: white;
        }

        .result-indicator.wrong {
            background: #e74c3c;
            color: white;
        }

        .mini-leaderboard {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ è·¯å¾„è§„åˆ’ä¸æ§åˆ¶æµ‹éªŒ</h1>
            <p>æµ‹è¯•ä½ å¯¹è§„åˆ’ç®—æ³•ä¸PIDæ§åˆ¶çš„æŒæ¡ç¨‹åº¦</p>
        </div>

        <div class="content">
            <!-- ç™»å½•é¡µé¢ -->
            <div class="login-page" id="login-page">
                <h2 style="color: #667eea; margin-bottom: 20px;">å¼€å§‹æµ‹éªŒ</h2>
                <p style="color: #666; margin-bottom: 15px;">è¯·è¾“å…¥ä½ çš„åå­—</p>
                <input type="text" id="username-input" placeholder="è¾“å…¥ä½ çš„åå­—" maxlength="20">
                <br>
                <button class="btn" onclick="startQuiz()">å¼€å§‹ç­”é¢˜</button>
                
                <div class="mini-leaderboard" style="margin-top: 30px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">ğŸ† å½“å‰æ’è¡Œæ¦œ</h3>
                    <div id="initial-leaderboard"></div>
                </div>
            </div>

            <!-- ç­”é¢˜é¡µé¢ -->
            <div class="quiz-page" id="quiz-page">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>

                <div class="quiz-info">
                    <div>ğŸ‘¤ <span id="display-username"></span></div>
                    <div>ğŸ“ <span id="current-question">1</span>/20</div>
                    <div class="timer">â±ï¸ <span id="timer">00:00</span></div>
                </div>

                <div class="question-card">
                    <div class="question-number">ç¬¬ <span id="question-num">1</span> é¢˜</div>
                    <div class="question-text" id="question-text"></div>
                    <ul class="options" id="options"></ul>
                    
                    <!-- ç­”æ¡ˆè§£æ -->
                    <div class="explanation" id="explanation">
                        <div class="result-indicator" id="result-indicator"></div>
                        <div class="explanation-title">ğŸ’¡ çŸ¥è¯†è®²è§£</div>
                        <div class="explanation-content" id="explanation-content"></div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="prevQuestion()" id="btn-prev">ä¸Šä¸€é¢˜</button>
                    <button class="btn" onclick="nextQuestion()" id="btn-next">ä¸‹ä¸€é¢˜</button>
                </div>
            </div>

            <!-- ç»“æœé¡µé¢ -->
            <div class="result-page" id="result-page">
                <h2 style="color: #667eea;">æµ‹éªŒå®Œæˆï¼</h2>
                <div class="score-display" id="final-score">0</div>
                <div class="result-info">
                    <p>æ­£ç¡®: <strong id="correct-count">0</strong> / 20</p>
                    <p>ç”¨æ—¶: <strong id="time-spent">00:00</strong></p>
                    <p>æ’å: ç¬¬ <strong id="rank">-</strong> å</p>
                </div>

                <div class="leaderboard">
                    <h2>ğŸ† æ’è¡Œæ¦œ TOP 10</h2>
                    <div id="leaderboard-list"></div>
                </div>

                <button class="btn" onclick="location.reload()" style="margin-top: 30px;">å†æ¥ä¸€æ¬¡</button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000/api';
        
        // é¢˜åº“ï¼ˆ100é“é¢˜ï¼‰
        const questionBank = [
            // åŸºç¡€æ¦‚å¿µ (20é¢˜)
            {q: "æ™ºèƒ½è½¦çš„'å¤§è„‘'æ˜¯æŒ‡ä»€ä¹ˆï¼Ÿ", o: ["ä¼ æ„Ÿå™¨", "æ§åˆ¶å™¨", "è½¦è½®", "æ–¹å‘ç›˜"], a: 1},
            {q: "ä¼ æ„Ÿå™¨åœ¨æ™ºèƒ½è½¦ä¸­æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Ÿ", o: ["å¤§è„‘", "çœ¼ç›", "æ‰‹", "è…¿"], a: 1},
            {q: "ä¸‹åˆ—å“ªä¸ªä¸æ˜¯æ™ºèƒ½è½¦çš„ç»„æˆéƒ¨åˆ†ï¼Ÿ", o: ["ä¼ æ„Ÿå™¨", "è®¡ç®—ç³»ç»Ÿ", "æ§åˆ¶ç³»ç»Ÿ", "åŠ æ²¹ç«™"], a: 3},
            {q: "è‡ªä¸»é©¾é©¶æ˜¯æŒ‡ä»€ä¹ˆï¼Ÿ", o: ["éœ€è¦äººæ§åˆ¶", "å®Œå…¨è‡ªåŠ¨", "åŠè‡ªåŠ¨", "é¥æ§"], a: 1},
            {q: "æ™ºèƒ½è½¦ä½¿ç”¨ä»€ä¹ˆæ¥æ„ŸçŸ¥ç¯å¢ƒï¼Ÿ", o: ["GPS", "ä¼ æ„Ÿå™¨", "åœ°å›¾", "Wi-Fi"], a: 1},
            {q: "æ™ºèƒ½è½¦çš„ä¸»è¦ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ", o: ["è·‘å¾—å¿«", "çœæ²¹", "å®‰å…¨è‡ªä¸»é©¾é©¶", "ä¾¿å®œ"], a: 2},
            {q: "ç›¸æœºåœ¨æ™ºèƒ½è½¦ä¸­ä¸»è¦ç”¨äºï¼Ÿ", o: ["æ‹ç…§", "è§†è§‰æ„ŸçŸ¥", "å½•åƒ", "å¨±ä¹"], a: 1},
            {q: "é›·è¾¾ä¼ æ„Ÿå™¨çš„ä½œç”¨æ˜¯ï¼Ÿ", o: ["æµ‹è·", "æ‹ç…§", "é€šè®¯", "åŠ çƒ­"], a: 0},
            {q: "æ™ºèƒ½è½¦éœ€è¦åšå‡ºä»€ä¹ˆå†³ç­–ï¼Ÿ", o: ["åªæœ‰è½¬å‘", "åªæœ‰åŠ é€Ÿ", "è½¬å‘ã€åŠ é€Ÿã€åˆ¹è½¦", "åªæœ‰åˆ¹è½¦"], a: 2},
            {q: "æ™ºèƒ½è½¦çš„è®¡ç®—ç³»ç»Ÿç”¨æ¥åšä»€ä¹ˆï¼Ÿ", o: ["å‘ç”µ", "å¤„ç†æ•°æ®å’Œç®—æ³•", "åˆ¶å†·", "ç…§æ˜"], a: 1},
            
            // è·¯å¾„è§„åˆ’ (20é¢˜)
            {q: "è·¯å¾„è§„åˆ’çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ", o: ["å¼€å¾—å¿«", "æ‰¾åˆ°ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„æœ€ä½³è·¯çº¿", "çœæ²¹", "æ¼‚äº®"], a: 1},
            {q: "A*ç®—æ³•çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ï¼Ÿ", o: ["é€Ÿåº¦æ…¢", "èƒ½æ‰¾åˆ°æœ€çŸ­è·¯å¾„ä¸”é€Ÿåº¦å¿«", "å ç”¨å†…å­˜å¤§", "å®ç°å›°éš¾"], a: 1},
            {q: "Dijkstraç®—æ³•çš„ç‰¹ç‚¹æ˜¯ï¼Ÿ", o: ["éšæœºæœç´¢", "ä¸€å®šèƒ½æ‰¾åˆ°æœ€çŸ­è·¯", "åªèƒ½èµ°ç›´çº¿", "ä¸èƒ½é¿éšœ"], a: 1},
            {q: "RRTç®—æ³•çš„å…¨ç§°æ˜¯ï¼Ÿ", o: ["å¿«é€Ÿéšæœºæ ‘", "æ…¢é€Ÿéšæœºæ ‘", "å›ºå®šè·¯å¾„æ ‘", "å¾ªç¯æ ‘"], a: 0},
            {q: "è·¯å¾„è§„åˆ’éœ€è¦è€ƒè™‘ä»€ä¹ˆï¼Ÿ", o: ["åªè¦èƒ½åˆ°è¾¾", "é¿å¼€éšœç¢ç‰©", "åªçœ‹è·ç¦»", "éšä¾¿èµ°"], a: 1},
            {q: "å“ªä¸ªç®—æ³•æœ€é€‚åˆå¤æ‚ç¯å¢ƒï¼Ÿ", o: ["ç›´çº¿ç®—æ³•", "RRTç®—æ³•", "ä¸è§„åˆ’", "éšæœºèµ°"], a: 1},
            {q: "è·¯å¾„è§„åˆ’çš„è¯„ä»·æŒ‡æ ‡ä¸åŒ…æ‹¬ï¼Ÿ", o: ["è·¯å¾„é•¿åº¦", "è®¡ç®—æ—¶é—´", "è½¦çš„é¢œè‰²", "å¹³æ»‘åº¦"], a: 2},
            {q: "æœ€çŸ­è·¯å¾„ä¸€å®šæ˜¯æœ€å¥½çš„å—ï¼Ÿ", o: ["æ˜¯", "ä¸ä¸€å®šï¼Œè¿˜è¦è€ƒè™‘å¹³æ»‘åº¦å’Œå®‰å…¨æ€§", "è‚¯å®šæ˜¯", "å¿…é¡»æ˜¯"], a: 1},
            {q: "A*ç®—æ³•åƒä»€ä¹ˆæ¸¸æˆï¼Ÿ", o: ["èµ›è·‘", "å¯»å®", "è·³èˆ", "ç¡è§‰"], a: 1},
            {q: "è§„åˆ’è·¯å¾„æ—¶éšœç¢ç‰©åº”è¯¥ï¼Ÿ", o: ["æ’è¿‡å»", "ç»•å¼€", "å¿½ç•¥", "æ¨å¼€"], a: 1},
            
            // PIDæ§åˆ¶ (20é¢˜)
            {q: "PIDä¸­çš„Pä»£è¡¨ä»€ä¹ˆï¼Ÿ", o: ["æ¯”ä¾‹", "ç§¯åˆ†", "å¾®åˆ†", "åŠŸç‡"], a: 0},
            {q: "PIDä¸­çš„Iä»£è¡¨ä»€ä¹ˆï¼Ÿ", o: ["æ¯”ä¾‹", "ç§¯åˆ†", "å¾®åˆ†", "åŠŸç‡"], a: 1},
            {q: "PIDä¸­çš„Dä»£è¡¨ä»€ä¹ˆï¼Ÿ", o: ["æ¯”ä¾‹", "ç§¯åˆ†", "å¾®åˆ†", "åŠŸç‡"], a: 2},
            {q: "Kpå‚æ•°å¤ªå¤§ä¼šå¯¼è‡´ï¼Ÿ", o: ["ååº”æ…¢", "æŒ¯è¡", "æ— ååº”", "å®Œç¾"], a: 1},
            {q: "Kpå‚æ•°å¤ªå°ä¼šå¯¼è‡´ï¼Ÿ", o: ["æŒ¯è¡", "ååº”æ…¢ã€åå·®å¤§", "å®Œç¾", "è¿‡å¿«"], a: 1},
            {q: "Kiçš„ä½œç”¨æ˜¯ï¼Ÿ", o: ["åŠ é€Ÿ", "æ¶ˆé™¤ç¨³æ€è¯¯å·®", "åˆ¹è½¦", "è½¬å‘"], a: 1},
            {q: "Kdçš„ä½œç”¨æ˜¯ï¼Ÿ", o: ["åŠ é€Ÿ", "å‡é€Ÿ", "é˜²æ­¢è¶…è°ƒ", "è½¬å‘"], a: 2},
            {q: "æ¯”ä¾‹æ§åˆ¶åƒä»€ä¹ˆï¼Ÿ", o: ["åˆ¹è½¦", "æ ¹æ®åå·®å¤§å°å†³å®šåŠ›åº¦", "ç¡è§‰", "ä¸åŠ¨"], a: 1},
            {q: "å¾®åˆ†æ§åˆ¶åƒä»€ä¹ˆï¼Ÿ", o: ["æ²¹é—¨", "æ–¹å‘ç›˜", "åˆ¹è½¦åŠŸèƒ½", "è½¦ç¯"], a: 2},
            {q: "ä¿å®ˆå‹PIDå‚æ•°çš„ç‰¹ç‚¹æ˜¯ï¼Ÿ", o: ["å¿«é€Ÿä½†ä¸ç¨³å®š", "ç¨³å®šä½†æ…¢", "æ—¢å¿«åˆç¨³", "ä¸èƒ½ç”¨"], a: 1},
            {q: "æ¿€è¿›å‹PIDå‚æ•°çš„ç‰¹ç‚¹æ˜¯ï¼Ÿ", o: ["æ…¢", "å¿«é€Ÿå“åº”ä½†å¯èƒ½æŒ¯è¡", "å®Œç¾", "ä¸åŠ¨"], a: 1},
            {q: "PIDæ§åˆ¶å™¨ç”¨äºï¼Ÿ", o: ["è§„åˆ’è·¯å¾„", "è®©è½¦ç²¾ç¡®è·Ÿè¸ªè·¯å¾„", "æ„ŸçŸ¥ç¯å¢ƒ", "å……ç”µ"], a: 1},
            {q: "Kp=1.5, Ki=0.05, Kd=0.3å±äºå“ªç§ç±»å‹ï¼Ÿ", o: ["ä¿å®ˆå‹", "å¹³è¡¡å‹", "æ¿€è¿›å‹", "ç¼“æ…¢å‹"], a: 2},
            {q: "Kp=0.6, Ki=0.01, Kd=0.4å±äºå“ªç§ç±»å‹ï¼Ÿ", o: ["ä¿å®ˆå‹", "æ¿€è¿›å‹", "é”™è¯¯å‹", "éšæœºå‹"], a: 0},
            {q: "ç§¯åˆ†é¥±å’Œæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ", o: ["ç§¯åˆ†å¤ªå°", "ç§¯åˆ†ç´¯ç§¯è¿‡å¤§", "ç§¯åˆ†ä¸ºé›¶", "æ²¡æœ‰ç§¯åˆ†"], a: 1},
            {q: "å¦‚ä½•é˜²æ­¢ç§¯åˆ†é¥±å’Œï¼Ÿ", o: ["ä¸ç”¨ç§¯åˆ†", "è®¾ç½®ç§¯åˆ†é™å¹…", "å¢å¤§ç§¯åˆ†", "å‡å°ç§¯åˆ†"], a: 1},
            {q: "è¶…è°ƒæ˜¯æŒ‡ï¼Ÿ", o: ["æ²¡æœ‰åˆ°è¾¾", "åˆšå¥½åˆ°è¾¾", "è¶…è¿‡ç›®æ ‡åˆå›æ¥", "æ…¢æ…¢åˆ°è¾¾"], a: 2},
            {q: "æŒ¯è¡æ˜¯æŒ‡ï¼Ÿ", o: ["ç¨³å®šå‰è¿›", "å·¦å³æ‘‡æ‘†", "åœæ­¢", "åé€€"], a: 1},
            {q: "ç¨³æ€è¯¯å·®æ˜¯æŒ‡ï¼Ÿ", o: ["åˆå§‹è¯¯å·®", "é•¿æœŸå­˜åœ¨çš„è¯¯å·®", "ç¬é—´è¯¯å·®", "æ²¡æœ‰è¯¯å·®"], a: 1},
            {q: "é™ä½é€Ÿåº¦å¯¹æ§åˆ¶çš„å½±å“æ˜¯ï¼Ÿ", o: ["æ›´éš¾æ§åˆ¶", "æ›´å®¹æ˜“ç²¾ç¡®è·Ÿè¸ª", "æ— å½±å“", "æ›´å¿«"], a: 1},
            
            // æ§åˆ¶è¯¯å·® (15é¢˜)
            {q: "CTEçš„å…¨ç§°æ˜¯ï¼Ÿ", o: ["è½¦é€Ÿè¯¯å·®", "æ¨ªå‘åå·®", "çºµå‘åå·®", "è§’åº¦è¯¯å·®"], a: 1},
            {q: "CTEçš„å•ä½æ˜¯ï¼Ÿ", o: ["åº¦", "ç±³", "ç§’", "å…¬é‡Œ"], a: 1},
            {q: "CTEä¸º0è¡¨ç¤ºï¼Ÿ", o: ["åç¦»è·¯å¾„", "è½¦è¾†åœ¨è·¯å¾„ä¸Š", "åœæ­¢", "åŠ é€Ÿ"], a: 1},
            {q: "CTEä¸ºæ­£è¡¨ç¤ºï¼Ÿ", o: ["è½¦åœ¨è·¯å¾„å·¦ä¾§", "è½¦åœ¨è·¯å¾„å³ä¾§", "è½¦åœ¨è·¯å¾„ä¸Š", "è½¦åœæ­¢"], a: 1},
            {q: "èˆªå‘è¯¯å·®æ˜¯æŒ‡ï¼Ÿ", o: ["é€Ÿåº¦å·®", "è½¦å¤´æ–¹å‘ä¸ç›®æ ‡æ–¹å‘çš„è§’åº¦å·®", "è·ç¦»å·®", "æ—¶é—´å·®"], a: 1},
            {q: "èˆªå‘è¯¯å·®çš„å•ä½æ˜¯ï¼Ÿ", o: ["ç±³", "ç§’", "åº¦æˆ–å¼§åº¦", "å…¬é‡Œ"], a: 2},
            {q: "ç†æƒ³çš„CTEåº”è¯¥ï¼Ÿ", o: ["å¾ˆå¤§", "æ¥è¿‘0", "æ— æ‰€è°“", "è´Ÿæ•°"], a: 1},
            {q: "ç†æƒ³çš„èˆªå‘è¯¯å·®åº”è¯¥ï¼Ÿ", o: ["180åº¦", "æ¥è¿‘0", "90åº¦", "éšä¾¿"], a: 1},
            {q: "å¹³å‡CTEå°äºå¤šå°‘æ˜¯ä¼˜ç§€ï¼Ÿ", o: ["1m", "0.3m", "5m", "10m"], a: 1},
            {q: "æœ€å¤§CTEå°äºå¤šå°‘æ˜¯åˆæ ¼ï¼Ÿ", o: ["0.1m", "1.5m", "10m", "100m"], a: 1},
            {q: "èˆªå‘è¯¯å·®å°äºå¤šå°‘åº¦æ˜¯è‰¯å¥½ï¼Ÿ", o: ["90åº¦", "15åº¦", "180åº¦", "360åº¦"], a: 1},
            {q: "å¦‚æœCTEæŒç»­å¢å¤§è¯´æ˜ï¼Ÿ", o: ["æ§åˆ¶è‰¯å¥½", "åç¦»è·¯å¾„", "åˆ°è¾¾ç»ˆç‚¹", "åœæ­¢"], a: 1},
            {q: "å¦‚æœèˆªå‘è¯¯å·®å¾ˆå¤§è¯´æ˜ï¼Ÿ", o: ["æ–¹å‘æ­£ç¡®", "æ–¹å‘åå·®å¤§", "é€Ÿåº¦å¿«", "é€Ÿåº¦æ…¢"], a: 1},
            {q: "æ§åˆ¶çš„ç›®æ ‡æ˜¯è®©è¯¯å·®ï¼Ÿ", o: ["å¢å¤§", "å‡å°åˆ°æ¥è¿‘0", "ä¿æŒä¸å˜", "éšä¾¿"], a: 1},
            {q: "å“ªä¸ªä¸æ˜¯æ§åˆ¶è¯¯å·®ï¼Ÿ", o: ["CTE", "èˆªå‘è¯¯å·®", "è½¦çš„é¢œè‰²", "é€Ÿåº¦è¯¯å·®"], a: 2},
            
            // åæ ‡ç³»ç»Ÿ (10é¢˜)
            {q: "åœ°å›¾åæ ‡çš„åŸç‚¹é€šå¸¸åœ¨ï¼Ÿ", o: ["ä¸­å¿ƒ", "å·¦ä¸Šè§’", "å³ä¸‹è§’", "éšæœº"], a: 1},
            {q: "Xè½´è¡¨ç¤ºï¼Ÿ", o: ["ä¸Šä¸‹", "å·¦å³", "æ·±åº¦", "æ—¶é—´"], a: 1},
            {q: "Yè½´è¡¨ç¤ºï¼Ÿ", o: ["å·¦å³", "ä¸Šä¸‹", "æ·±åº¦", "é€Ÿåº¦"], a: 1},
            {q: "è½¦è¾†çš„æœå‘ç”¨ä»€ä¹ˆè¡¨ç¤ºï¼Ÿ", o: ["x", "y", "Î¸(theta)", "v"], a: 2},
            {q: "è½¦è¾†ä½ç½®ç”¨ä»€ä¹ˆè¡¨ç¤ºï¼Ÿ", o: ["åªæœ‰x", "åªæœ‰y", "(x, y)", "åªæœ‰Î¸"], a: 2},
            {q: "é€Ÿåº¦ç”¨ä»€ä¹ˆå­—æ¯è¡¨ç¤ºï¼Ÿ", o: ["x", "y", "Î¸", "v"], a: 3},
            {q: "è§’é€Ÿåº¦ç”¨ä»€ä¹ˆå­—æ¯è¡¨ç¤ºï¼Ÿ", o: ["v", "Ï‰(omega)", "x", "y"], a: 1},
            
            // è¿åŠ¨å­¦æ¨¡å‹ (10é¢˜)
            {q: "è‡ªè¡Œè½¦æ¨¡å‹æ˜¯ä»€ä¹ˆï¼Ÿ", o: ["çœŸçš„è‡ªè¡Œè½¦", "è½¦è¾†è¿åŠ¨çš„ç®€åŒ–æ¨¡å‹", "ç©å…·", "æ¸¸æˆ"], a: 1},
            {q: "våœ¨è¿åŠ¨å­¦ä¸­è¡¨ç¤ºï¼Ÿ", o: ["ä½“ç§¯", "é€Ÿåº¦", "ç”µå‹", "é‡é‡"], a: 1},
            {q: "Ï‰åœ¨è¿åŠ¨å­¦ä¸­è¡¨ç¤ºï¼Ÿ", o: ["é‡é‡", "é€Ÿåº¦", "è§’é€Ÿåº¦", "åŠŸç‡"], a: 2},
            {q: "x' = v Ã— cos(Î¸)è¡¨ç¤ºï¼Ÿ", o: ["Yæ–¹å‘é€Ÿåº¦", "Xæ–¹å‘é€Ÿåº¦", "è§’é€Ÿåº¦", "åŠ é€Ÿåº¦"], a: 1},
            {q: "y' = v Ã— sin(Î¸)è¡¨ç¤ºï¼Ÿ", o: ["Xæ–¹å‘é€Ÿåº¦", "Yæ–¹å‘é€Ÿåº¦", "è§’é€Ÿåº¦", "åŠ é€Ÿåº¦"], a: 1},
            {q: "Î¸' = Ï‰è¡¨ç¤ºï¼Ÿ", o: ["ä½ç½®å˜åŒ–", "é€Ÿåº¦å˜åŒ–", "è§’åº¦å˜åŒ–ç‡", "æ— æ„ä¹‰"], a: 2},
            {q: "æ§åˆ¶å‘¨æœŸé€šå¸¸æ˜¯å¤šå°‘æ¯«ç§’ï¼Ÿ", o: ["1ms", "50ms", "1000ms", "10000ms"], a: 1},
            {q: "Ï‰ä¸ºæ­£è¡¨ç¤ºï¼Ÿ", o: ["ç›´è¡Œ", "é€†æ—¶é’ˆè½¬", "é¡ºæ—¶é’ˆè½¬", "åé€€"], a: 1},
            {q: "Ï‰ä¸ºè´Ÿè¡¨ç¤ºï¼Ÿ", o: ["ç›´è¡Œ", "é€†æ—¶é’ˆè½¬", "é¡ºæ—¶é’ˆè½¬", "åé€€"], a: 2},
            {q: "dtè¡¨ç¤ºï¼Ÿ", o: ["è·ç¦»", "é€Ÿåº¦", "æ—¶é—´é—´éš”", "è§’åº¦"], a: 2},
            
            // ç»¼åˆåº”ç”¨ (5é¢˜)
            {q: "åœ¨åœè½¦åœºæ™¯ä¸­æœ€é‡è¦çš„æ˜¯ï¼Ÿ", o: ["é€Ÿåº¦å¿«", "ç²¾ç¡®æ§åˆ¶", "å£°éŸ³å¤§", "ç¯å…‰äº®"], a: 1},
            {q: "åœ¨é«˜é€Ÿå…¬è·¯ä¸Šæœ€é‡è¦çš„æ˜¯ï¼Ÿ", o: ["ä¿æŒè½¦é“", "å·¦å³æ‘‡æ‘†", "æ€¥åˆ¹è½¦", "æ€¥è½¬å¼¯"], a: 0},
            {q: "é¿è®©è¡Œäººæ—¶åº”è¯¥ï¼Ÿ", o: ["åŠ é€Ÿå†²è¿‡å»", "å‡é€Ÿæˆ–åœè½¦", "æŒ‰å–‡å­", "ä¸ç®¡"], a: 1},
            {q: "ç´§æ€¥æƒ…å†µä¸‹åº”è¯¥ï¼Ÿ", o: ["ç»§ç»­å‰è¿›", "ç´§æ€¥åˆ¶åŠ¨æˆ–é¿éšœ", "åŠ é€Ÿ", "å…³æœº"], a: 1},
            {q: "å¤šè½¦ååŒçš„å¥½å¤„æ˜¯ï¼Ÿ", o: ["æ›´å¿«", "æ›´å®‰å…¨é«˜æ•ˆ", "æ›´ä¾¿å®œ", "æ›´å¥½çœ‹"], a: 1}
        ];

        let username = '';
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let answers = [];
        let startTime = 0;
        let timerInterval = null;

        // å¼€å§‹æµ‹éªŒ
        function startQuiz() {
            username = document.getElementById('username-input').value.trim();
            if (!username) {
                alert('è¯·è¾“å…¥ä½ çš„åå­—ï¼');
                return;
            }

            // éšæœºæŠ½å–20é“é¢˜
            currentQuestions = shuffleArray([...questionBank]).slice(0, 20);
            answers = new Array(20).fill(null);
            currentQuestionIndex = 0;
            
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('quiz-page').style.display = 'block';
            document.getElementById('display-username').textContent = username;

            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);

            showQuestion();
        }

        // æ´—ç‰Œç®—æ³•
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // æ˜¾ç¤ºé—®é¢˜
        function showQuestion() {
            const question = currentQuestions[currentQuestionIndex];
            document.getElementById('question-num').textContent = currentQuestionIndex + 1;
            document.getElementById('current-question').textContent = currentQuestionIndex + 1;
            document.getElementById('question-text').textContent = question.q;

            const optionsHtml = question.o.map((opt, idx) => 
                `<li class="option ${answers[currentQuestionIndex] === idx ? 'selected' : ''}" 
                     onclick="selectOption(${idx})">${String.fromCharCode(65 + idx)}. ${opt}</li>`
            ).join('');
            document.getElementById('options').innerHTML = optionsHtml;

            document.getElementById('btn-prev').disabled = currentQuestionIndex === 0;
            document.getElementById('btn-next').textContent = currentQuestionIndex === 19 ? 'æäº¤ç­”æ¡ˆ' : 'ä¸‹ä¸€é¢˜';

            // æ›´æ–°è¿›åº¦æ¡
            const progress = ((currentQuestionIndex + 1) / 20) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
        }

        // é€‰æ‹©é€‰é¡¹
        function selectOption(idx) {
            answers[currentQuestionIndex] = idx;
            showQuestion();
        }

        // ä¸Šä¸€é¢˜
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        // ä¸‹ä¸€é¢˜/æäº¤
        function nextQuestion() {
            if (answers[currentQuestionIndex] === null) {
                alert('è¯·é€‰æ‹©ä¸€ä¸ªç­”æ¡ˆï¼');
                return;
            }

            if (currentQuestionIndex === 19) {
                submitQuiz();
            } else {
                currentQuestionIndex++;
                showQuestion();
            }
        }

        // æ›´æ–°è®¡æ—¶å™¨
        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('timer').textContent = 
                `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        // æäº¤æµ‹éªŒ
        async function submitQuiz() {
            clearInterval(timerInterval);
            
            // è®¡ç®—åˆ†æ•°
            let correct = 0;
            for (let i = 0; i < 20; i++) {
                if (answers[i] === currentQuestions[i].a) {
                    correct++;
                }
            }
            
            const score = correct * 5; // æ¯é¢˜5åˆ†
            const timeSpent = (Date.now() - startTime) / 1000;

            // æäº¤åˆ°æœåŠ¡å™¨
            try {
                const response = await fetch(`${API_URL}/quiz/submit`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        username: username,
                        score: score,
                        total: 100,
                        time_spent: timeSpent,
                        timestamp: new Date().toISOString()
                    })
                });
                
                const data = await response.json();
                showResult(score, correct, timeSpent, data.rank);
            } catch (error) {
                console.error('æäº¤å¤±è´¥:', error);
                showResult(score, correct, timeSpent, -1);
            }
        }

        // æ˜¾ç¤ºç»“æœ
        async function showResult(score, correct, timeSpent, rank) {
            document.getElementById('quiz-page').style.display = 'none';
            document.getElementById('result-page').style.display = 'block';

            document.getElementById('final-score').textContent = score + ' åˆ†';
            document.getElementById('correct-count').textContent = correct;
            
            const minutes = Math.floor(timeSpent / 60);
            const seconds = Math.floor(timeSpent % 60);
            document.getElementById('time-spent').textContent = 
                `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            document.getElementById('rank').textContent = rank > 0 ? rank : 'æäº¤å¤±è´¥';

            // åŠ è½½æ’è¡Œæ¦œ
            await loadLeaderboard();
        }

        // åŠ è½½æ’è¡Œæ¦œ
        async function loadLeaderboard() {
            try {
                const response = await fetch(`${API_URL}/quiz/leaderboard`);
                const data = await response.json();
                
                if (data.success) {
                    const leaderboardHtml = data.data.slice(0, 10).map((item, idx) => {
                        const rankClass = idx === 0 ? 'gold' : idx === 1 ? 'silver' : idx === 2 ? 'bronze' : '';
                        const isMe = item.username === username;
                        
                        return `
                            <div class="leaderboard-item ${isMe ? 'me' : ''}">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <span class="rank ${rankClass}">#${idx + 1}</span>
                                    <div>
                                        <div style="font-size: 18px;">${item.username} ${isMe ? '(ä½ )' : ''}</div>
                                        <div style="font-size: 12px; color: #999;">${Math.floor(item.time_spent / 60)}åˆ†${Math.floor(item.time_spent % 60)}ç§’</div>
                                    </div>
                                </div>
                                <div style="font-size: 24px; font-weight: bold; color: #667eea;">${item.score}åˆ†</div>
                            </div>
                        `;
                    }).join('');
                    
                    document.getElementById('leaderboard-list').innerHTML = leaderboardHtml;
                }
            } catch (error) {
                console.error('åŠ è½½æ’è¡Œæ¦œå¤±è´¥:', error);
            }
        }
    </script>
</body>
</html>
