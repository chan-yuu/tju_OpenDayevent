<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚗 智能车路径规划与控制系统</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <!-- 导航栏 -->
    <header class="header">
        <div class="logo">
            <span class="logo-icon">🚗</span>
            <span class="logo-text">智能车路径规划与控制</span>
        </div>
        <nav class="nav">
            <a href="quiz.html" class="nav-btn" style="text-decoration: none;font-size: 14px;">📝 知识测验</a>
            <!-- <button id="btn-about" class="nav-btn">💡 关于系统</button> -->
            <button id="btn-about" class="nav-btn" style="font-size: 14px;">💡 关于系统</button>
        </nav>
    </header>

    <!-- 主容器 -->
    <div class="main-container">
        <!-- 左侧控制面板 -->
        <aside class="control-panel">
            <!-- 标签页导航 -->
            <div class="tab-navigation">
                <button class="tab-btn active" data-tab="planning">🎯 路径规划</button>
                <button class="tab-btn" data-tab="control">🚗 轨迹控制</button>
            </div>

            <!-- 规划标签页内容 -->
            <div class="tab-content active" id="planning-tab">
                <div class="panel-section">
                    <h3>🗺️ 场景设置</h3>
                    <div class="form-group">
                        <label>预设场景</label>
                        <select id="scenario-select" class="form-control">
                            <option value="">自定义</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>地图尺寸</label>
                        <div class="input-row">
                            <input type="number" id="map-width" class="form-control" value="70" min="10" max="100">
                            <span>×</span>
                            <input type="number" id="map-height" class="form-control" value="70" min="10" max="100">
                        </div>
                    </div>
                    <div class="button-row">
                        <button id="btn-reset-map" class="btn btn-secondary">重置地图</button>
                        <button id="btn-save-map" class="btn btn-primary">💾 保存地图</button>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>✏️ 编辑模式</h3>
                    <div class="edit-modes">
                        <button class="mode-btn active" data-mode="obstacle">
                            <span class="icon">🧱</span>
                            <span>障碍物</span>
                        </button>
                        <button class="mode-btn" data-mode="start">
                            <span class="icon">🟢</span>
                            <span>起点</span>
                        </button>
                        <button class="mode-btn" data-mode="goal">
                            <span class="icon">🔴</span>
                            <span>终点</span>
                        </button>
                        <button class="mode-btn" data-mode="erase">
                            <span class="icon">🗑️</span>
                            <span>擦除</span>
                        </button>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>🎯 算法选择</h3>
                    <div class="form-group">
                        <label>规划算法</label>
                        <select id="algorithm-select" class="form-control">
                            <optgroup label="图搜索算法">
                                <option value="astar">A*</option>
                                <option value="dijkstra">Dijkstra</option>
                                <option value="gbfs">GBFS</option>
                                <option value="jps">JPS</option>
                                <option value="theta_star">Theta*</option>
                                <option value="lazy_theta_star">Lazy Theta*</option>
                            </optgroup>
                            <optgroup label="采样算法">
                                <option value="rrt">RRT</option>
                                <option value="rrt_star">RRT*</option>
                                <option value="rrt_connect">RRT-Connect</option>
                            </optgroup>
                            <optgroup label="混合算法">
                                <option value="voronoi">Voronoi</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="button-row">
                        <button id="btn-plan" class="btn btn-primary">开始规划</button>
                        <button id="btn-clear-path" class="btn btn-secondary">清除路径</button>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>👁️ 显示选项</h3>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="show-grid" checked>
                            <span>网格线</span>
                        </label>
                        <label>
                            <input type="checkbox" id="show-expanded" checked>
                            <span>搜索节点</span>
                        </label>
                        <label>
                            <input type="checkbox" id="show-path" checked>
                            <span>规划路径</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- 控制标签页内容 -->
            <div class="tab-content" id="control-tab">
                <div class="panel-section">
                    <h3>🚗 车辆模型</h3>
                    <div class="info-text"
                        style="padding: 8px; background: rgba(0,212,255,0.1); border-radius: 4px; font-size: 12px; color: #00d4ff;">
                        🚙 类车模型（自行车模型）+ PID闭环控制
                    </div>
                </div>

                <div class="panel-section">
                    <h3>⚙️ PID控制参数</h3>
                    
                    <!-- 预设参数选择器 -->
                    <div class="param-item" style="margin-bottom: 15px; padding: 10px; background: rgba(0,212,255,0.05); border-radius: 4px;">
                        <label class="param-label" style="font-weight: bold;">📋 参数预设</label>
                        <select id="pid-preset" style="width: 100%; padding: 5px; font-size: 13px; border-radius: 4px; border: 1px solid #00d4ff;">
                            <option value="custom">自定义</option>
                            <option value="conservative" selected>保守型 (稳定优先)</option>
                            <option value="balanced">平衡型 (推荐)</option>
                            <option value="aggressive">激进型 (响应快)</option>
                            <option value="slow">缓慢型 (低速高精度)</option>
                        </select>
                        <div style="font-size: 10px; color: #888; margin-top: 5px;">
                            💡 选择预设后可微调参数
                        </div>
                    </div>
                    
                    <div class="controller-params" id="controller-params">
                        <div class="param-item">
                            <label class="param-label">Kp (比例增益)</label>
                            <input type="range" id="param-kp" min="0.1" max="3" step="0.05" value="0.6" class="slider">
                            <span id="param-kp-value">0.6</span>
                        </div>
                        <div class="param-item">
                            <label class="param-label">Ki (积分增益)</label>
                            <input type="range" id="param-ki" min="0" max="0.5" step="0.01" value="0.01" class="slider">
                            <span id="param-ki-value">0.01</span>
                        </div>
                        <div class="param-item">
                            <label class="param-label">Kd (微分增益)</label>
                            <input type="range" id="param-kd" min="0" max="2" step="0.05" value="0.4" class="slider">
                            <span id="param-kd-value">0.4</span>
                        </div>
                        <div class="param-item">
                            <label class="param-label">目标速度 (m/s)</label>
                            <input type="range" id="param-speed" min="0.3" max="2" step="0.1" value="0.6"
                                class="slider">
                            <span id="param-speed-value">0.6</span>
                        </div>
                    </div>
                    <div class="hint-text" style="font-size: 14px; color: #888; margin-top: 10px;">
                        💡 Kp过大会振荡，过小响应慢<br>
                        💡 Ki消除稳态误差，过大会超调<br>
                        💡 Kd抑制振荡，提高稳定性<br>
                        💡 降低速度可提高跟踪精度
                    </div>
                </div>

                <div class="panel-section">
                    <h3>🎮 控制操作</h3>
                    <div class="button-group" style="margin-bottom: 10px;">
                        <button id="btn-pause-control" class="btn btn-warning" style="display: none;">
                            ⏸️ 暂停
                        </button>
                        <button id="btn-resume-control" class="btn btn-success" style="display: none;">
                            ▶️ 恢复
                        </button>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>👁️ 显示选项</h3>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="show-vehicle" checked>
                            <span>车辆</span>
                        </label>
                        <label>
                            <input type="checkbox" id="show-control-trajectory" checked>
                            <span>实时轨迹</span>
                        </label>
                    </div>
                </div>

                <button id="btn-start-control" class="btn btn-success btn-block">🎮 开始PID闭环控制</button>
                <button id="btn-stop-control" class="btn btn-danger btn-block" style="display:none;">⏹️ 停止控制</button>
                
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0,212,255,0.2);">
                    <button id="btn-compare-pid" class="btn btn-warning btn-block">📊 PID参数对比</button>
                    <div id="comparison-info" style="display:none; margin-top:10px; padding:10px; background:rgba(0,212,255,0.1); border-radius:4px; font-size:12px;">
                        <div style="color:#00d4ff; margin-bottom:5px;">对比模式：同时模拟多组参数</div>
                        <div style="color:#888;">• 保守型 (蓝色)</div>
                        <div style="color:#888;">• 平衡型 (绿色)</div>
                        <div style="color:#888;">• 激进型 (红色)</div>
                        <div style="color:#888;">• 缓慢型 (黄色)</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- 中间画布区域 -->
        <main class="canvas-area">
            <div class="canvas-container">
                <canvas id="main-canvas"></canvas>
                <div id="canvas-tooltip" class="canvas-tooltip"></div>
            </div>
            <div class="canvas-info">
                <div class="info-item">
                    <span class="info-label">鼠标位置:</span>
                    <span id="mouse-pos">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">编辑模式:</span>
                    <span id="current-mode">障碍物</span>
                </div>
            </div>
        </main>

        <!-- 右侧性能面板 -->
        <aside class="stats-panel">
            <div class="panel-section">
                <h3>📊 性能统计</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">计算时间</div>
                        <div class="stat-value" id="stat-time">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">路径长度</div>
                        <div class="stat-value" id="stat-length">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">搜索节点数</div>
                        <div class="stat-value" id="stat-nodes">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">状态</div>
                        <div class="stat-value" id="stat-status">就绪</div>
                    </div>
                </div>
            </div>

            <div class="panel-section">
                <h3>📈 算法对比</h3>
                <div id="comparison-list" class="comparison-list">
                    <p class="hint-text">运行多个算法进行对比</p>
                </div>
                <button id="btn-add-comparison" class="btn btn-secondary btn-block">添加对比</button>
            </div>

            <div class="panel-section" id="control-stats-panel" style="display:none;">
                <h3>📊 控制统计</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">平均CTE</div>
                        <div class="stat-value" id="stat-avg-cte">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">最大CTE</div>
                        <div class="stat-value" id="stat-max-cte">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">平均航向误差</div>
                        <div class="stat-value" id="stat-avg-heading">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">控制步数</div>
                        <div class="stat-value" id="stat-control-steps">-</div>
                    </div>
                </div>
                <div class="error-chart-container" style="margin-top:15px;">
                    <canvas id="error-chart" style="width:100%; height:200px; background:#0a0e27;"></canvas>
                </div>
            </div>

            <div class="panel-section">
                <h3>ℹ️ 算法信息</h3>
                <div id="algorithm-info" class="algorithm-info">
                    <p class="hint-text">选择算法查看详细信息</p>
                </div>
            </div>
        </aside>
    </div>

    <!-- 底部状态栏 -->
    <footer class="footer">
        <div class="footer-content">
            <span>© 2026 自动驾驶决策规划演示系统</span>
            <span id="connection-status" class="status-indicator">● 已连接</span>
        </div>
    </footer>

    <!-- 模态对话框 -->
    <!-- 模态对话框 -->
    <div id="about-modal" class="modal">
        <div class="modal-content" style="font-family: 'Microsoft YaHei', Arial, sans-serif; line-height: 1.6; padding: 30px; border-radius: 12px; background: #fefefe; margin: 5% auto; width: 80%; max-width: 800px;">
            <span class="modal-close" style="font-size: 28px; color: #666; float: right; font-weight: bold; cursor: pointer;">&times;</span>
            <h2 style="font-size: 24px; color: var(--primary-color); margin-bottom: 20px; text-align: center;">🚗 智能车路径规划与控制系统</h2>
            <p style="font-size: 16px; color: #333; margin: 10px 0;">本系统是一个交互式的教学演示平台，专为中小学生设计，用于学习和理解自动驾驶中的路径规划和轨迹跟踪控制算法。</p>

            <h3 style="font-size: 20px; color: var(--primary-color); margin: 25px 0 10px 0;">✨ 核心功能</h3>
            <ul style="margin: 10px 0;">
                <li style="font-size: 15px; color: #444; margin: 8px 0;">🎯 <strong style="color: var(--primary-color);">路径规划</strong>: 10种经典算法，可视化搜索过程</li>
                <li style="font-size: 15px; color: #444; margin: 8px 0;">🚗 <strong style="color: var(--primary-color);">轨迹控制</strong>: 多种车辆模型和控制算法</li>
                <li style="font-size: 15px; color: #444; margin: 8px 0;">🗺️ <strong style="color: var(--primary-color);">场景编辑</strong>: 自由绘制地图和障碍物</li>
                <li style="font-size: 15px; color: #444; margin: 8px 0;">📊 <strong style="color: var(--primary-color);">性能对比</strong>: 实时统计计算时间、路径长度</li>
                <li style="font-size: 15px; color: #444; margin: 8px 0;">🎬 <strong style="color: var(--primary-color);">动画演示</strong>: 平滑的车辆运动可视化</li>
            </ul>

            <h3 style="font-size: 20px; color: var(--primary-color); margin: 25px 0 10px 0;">🎯 路径规划算法 </h3>
            <ul style="margin: 10px 0;">
                <li style="font-size: 15px; color: #444; margin: 8px 0;"><strong style="color: var(--primary-color);">图搜索算法</strong>: A*, Dijkstra, GBFS, JPS, Theta*, Lazy Theta*</li>
                <li style="font-size: 15px; color: #444; margin: 8px 0;"><strong style="color: var(--primary-color);">采样算法</strong>: RRT, RRT*, RRT-Connect</li>
                <li style="font-size: 15px; color: #444; margin: 8px 0;"><strong style="color: var(--primary-color);">混合算法</strong>: Voronoi Planner</li>
            </ul>

            <h3 style="font-size: 20px; color: var(--primary-color); margin: 25px 0 10px 0;">🚗 轨迹控制算法 </h3>
            <ul style="margin: 10px 0;">
                <li style="font-size: 15px; color: #444; margin: 8px 0;"><strong style="color: var(--primary-color);">PID控制</strong>: 经典反馈控制器</li>
            </ul>

            <h3 style="font-size: 20px; color: var(--primary-color); margin: 25px 0 10px 0;">💡 技术栈</h3>
            <p style="font-size: 16px; color: #333; margin: 10px 0;"><strong style="color: var(--primary-color);">后端</strong>: Python, FastAPI, python_motion_planning</p>
            <p style="font-size: 16px; color: #333; margin: 10px 0;"><strong style="color: var(--primary-color);">前端</strong>: HTML5 Canvas, JavaScript ES6+</p>

            <div style="text-align: center; margin-top: 25px; padding-top: 25px; border-top: 6px solid var(--primary-color);">
                <p style="color: var(--primary-color); font-size: 18px; font-weight: 500;">© 2026 TJU Planner Lab (by cyun) | 教育演示用途</p>
            </div>
        </div>
    </div>

    <!-- 保存地图对话框 -->
    <div id="save-map-modal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <span class="modal-close">&times;</span>
            <h2>💾 保存地图</h2>
            <div class="form-group" style="margin: 20px 0;">
                <label>地图名称</label>
                <input type="text" id="save-map-name" class="form-control" placeholder="例如：我的迷宫">
            </div>
            <div class="form-group" style="margin: 20px 0;">
                <label>地图描述</label>
                <textarea id="save-map-description" class="form-control" rows="3" placeholder="简单描述这个地图..."></textarea>
            </div>
            <div class="button-row">
                <button id="btn-confirm-save" class="btn btn-primary">确认保存</button>
                <button id="btn-cancel-save" class="btn btn-secondary">取消</button>
            </div>
        </div>
    </div>

    <!-- 加载脚本 -->
    <script src="js/config.js"></script>
    <script src="js/canvas.js"></script>
    <script src="js/api.js"></script>
    <script src="js/app.js"></script>
</body>

</html>