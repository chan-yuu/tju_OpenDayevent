# 校园智能调度系统 - 项目说明

## 📋 项目概述

这是一个面向校园环境的无人驾驶接驳车/物流车智能调度系统。通过直观的可视化界面，用户可以：
- 创建校园地图
- 设置节点和道路网络
- 后续将实现各种调度算法的可视化演示

## 🎯 当前完成功能

### ✅ 地图创建模块（已完成）
- **背景地图上传**：支持PNG/JPG格式的卫星地图
- **节点创建**：10种节点类型，可自定义名称和位置
- **道路创建**：支持直线和折线道路，自动计算长度
- **地图保存/加载**：JSON格式存储，支持多地图管理
- **可视化编辑**：实时预览，拖拽操作，删除功能

## 📁 项目结构

```
tju-scheduling-lab/
├── backend/                    # 后端服务
│   ├── app.py                 # Flask API服务器
│   ├── requirements.txt       # Python依赖
│   └── data/                  # 数据存储目录（自动创建）
│       ├── maps/              # 地图配置JSON文件
│       └── uploads/           # 上传的背景图片
│
├── frontend/                   # 前端界面
│   ├── map-editor.html        # 地图编辑器界面
│   ├── map-editor.js          # 交互逻辑
│   └── map.png               # 示例背景图
│
├── docs/                       # 文档目录
│   ├── demo_design.md         # Demo设计文档
│   └── vibecode.md           # 原始需求文档
│
├── start.sh / start.bat       # 一键启动脚本（Linux/Windows）
├── stop.sh / stop.bat         # 停止服务脚本
├── README.md                  # 项目主文档
└── USAGE.md                   # 使用指南
```

## 🚀 快速开始

### 方式一：一键启动（推荐）

**Linux/Mac:**
```bash
./start.sh
```

**Windows:**
```cmd
start.bat
```

### 方式二：手动启动

1. **安装依赖**
```bash
cd backend
pip install -r requirements.txt
```

2. **启动后端**
```bash
python app.py
```

3. **启动前端**（新开终端）
```bash
cd frontend
python -m http.server 8080
```

4. **访问系统**
浏览器打开：http://localhost:8080/map-editor.html

## 🎨 界面说明

### 主界面布局
```
┌─────────────────────────────────────────────────┐
│  左侧工具栏            │      画布区域          │
│  - 地图信息           │    - 背景地图显示      │
│  - 操作模式切换       │    - 节点和边可视化    │
│  - 节点/边设置        │    - 实时统计信息      │
│  - 保存/加载按钮      │                        │
│  - 节点/边列表        │                        │
└─────────────────────────────────────────────────┘
```

### 操作模式
1. **创建节点模式** 🎯
   - 设置节点名称和类型
   - 点击地图创建节点
   
2. **创建边模式** 🔗
   - 点击起始节点
   - 添加折点（可选）
   - 点击结束节点
   
3. **删除模式** 🗑️
   - 点击节点或边进行删除
   
4. **查看模式** 👁️
   - 只查看不编辑

## 📊 数据格式

### 节点数据结构
```json
{
  "id": 1706345678901,
  "name": "东门",
  "type": "大门",
  "x": 350,
  "y": 250
}
```

### 边数据结构
```json
{
  "id": 1706345678902,
  "startNodeId": 1706345678901,
  "endNodeId": 1706345678903,
  "waypoints": [
    {"x": 400, "y": 300},
    {"x": 450, "y": 350}
  ],
  "length": 156
}
```

### 地图数据结构
```json
{
  "id": "map_20250127_120000",
  "name": "天津大学卫津路校区",
  "background_image": "data:image/png;base64,...",
  "nodes": [...],
  "edges": [...],
  "created_at": "2025-01-27T12:00:00",
  "updated_at": "2025-01-27T12:30:00"
}
```

## 🔧 API接口

### 节点类型
- `GET /api/node-types` - 获取所有节点类型

### 地图管理
- `GET /api/maps` - 获取地图列表
- `GET /api/map/<map_id>` - 获取指定地图
- `POST /api/map` - 保存地图
- `DELETE /api/map/<map_id>` - 删除地图

### 图片管理
- `POST /api/upload-image` - 上传图片
- `GET /api/images/<filename>` - 获取图片

## 🎓 节点类型说明

| 类型 | 图标 | 用途 | 颜色 |
|------|------|------|------|
| 宿舍 | 🏠 | 学生住宿区 | 红色 |
| 大门 | 🚪 | 校园出入口 | 青色 |
| 教学楼 | 🏫 | 教学区域 | 蓝色 |
| 图书馆 | 📚 | 学习场所 | 绿色 |
| 实验楼 | 🔬 | 实验区域 | 黄色 |
| 工程馆 | 🏗️ | 工程实践 | 灰色 |
| 食堂 | 🍽️ | 就餐地点 | 粉色 |
| 操场 | ⚽ | 运动场所 | 紫色 |
| 体育馆 | 🏀 | 室内运动 | 深紫 |
| 充电站 | 🔋 | 车辆充电 | 绿色 |

## 🔮 后续开发计划

### 阶段二：调度算法（规划中）
- [ ] Dijkstra最短路径算法
- [ ] A*启发式搜索算法
- [ ] Floyd-Warshall全源最短路径
- [ ] 贪心调度算法

### 阶段三：车辆模拟（规划中）
- [ ] 车辆实体设计
- [ ] 路径动画
- [ ] 实时位置追踪
- [ ] 多车辆管理

### 阶段四：智能调度（规划中）
- [ ] 任务队列管理
- [ ] 动态路径规划
- [ ] 充电策略优化
- [ ] 多车辆协同

### 阶段五：数据分析（规划中）
- [ ] 调度效率统计
- [ ] 路径长度分析
- [ ] 车辆利用率
- [ ] 可视化报表

## ⚙️ 技术栈

- **前端**: 
  - HTML5 Canvas（绘图）
  - 原生JavaScript（逻辑）
  - 渐变背景（美化）

- **后端**: 
  - Python 3.8+
  - Flask 2.3.0（Web框架）
  - Flask-CORS（跨域支持）

- **数据存储**: 
  - JSON文件（轻量级）
  - 文件系统（图片存储）

## 🐛 常见问题

### 1. 后端服务启动失败
**可能原因**：
- Python版本过低（需要3.7+）
- 依赖未安装
- 端口5000被占用

**解决方案**：
```bash
# 检查Python版本
python --version

# 重新安装依赖
pip install -r backend/requirements.txt --user

# 检查端口占用
lsof -i:5000  # Linux/Mac
netstat -ano | findstr :5000  # Windows
```

### 2. 前端无法连接后端
**解决方案**：
1. 确认后端已启动
2. 测试API：访问 http://localhost:5000/api/node-types
3. 检查浏览器控制台错误信息

### 3. 图片上传失败
**解决方案**：
1. 检查图片格式（仅支持PNG/JPG）
2. 确认文件大小合理（建议<10MB）
3. 查看后端日志

### 4. 地图保存失败
**解决方案**：
1. 确认已填写地图名称
2. 确认至少创建了一个节点
3. 检查 backend/data/maps 目录权限

## 📝 开发建议

### 创建地图最佳实践
1. **准备清晰的背景图**
   - 使用高清卫星地图
   - 标注清楚关键建筑
   - 比例尺合适

2. **合理规划节点**
   - 重要地点必设节点
   - 路口交叉点设节点
   - 节点名称简洁明确

3. **精确绘制道路**
   - 使用折点模拟真实路径
   - 避免道路交叉重叠
   - 单行道用不同方向的边表示

4. **定期保存**
   - 创建关键节点后保存
   - 完成一片区域后保存
   - 使用有意义的地图名称

## 📄 许可证

MIT License

## 👥 贡献

欢迎提交Issue和Pull Request！

## 📧 联系方式

如有问题，请通过以下方式联系：
- 提交GitHub Issue
- 查看项目文档
- 参考使用指南（USAGE.md）

---

**祝使用愉快！🎉**
