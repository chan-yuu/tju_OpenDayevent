# 地图编辑器功能演示

## 🎯 功能概览

### 1. 地图创建流程

#### 步骤1：准备背景图
```
选择背景图 → 上传PNG/JPG → 自动适配画布
```

#### 步骤2：创建节点
```
输入节点名称 → 选择节点类型 → 点击地图位置 → 节点创建成功
```

#### 步骤3：创建道路
```
点击起始节点 → [可选]添加折点 → 点击结束节点 → 道路创建完成
```

#### 步骤4：保存地图
```
输入地图名称 → 点击保存按钮 → 获取保存确认
```

## 📝 操作示例

### 示例1：创建简单校园地图

**场景**：创建一个包含4个节点的简单校园地图

1. **上传背景图**
   ```
   点击"选择地图图片" → 选择校园卫星图 → 等待加载
   ```

2. **创建节点**
   ```
   节点1: 名称="东门", 类型="大门", 位置=(200, 300)
   节点2: 名称="图书馆", 类型="图书馆", 位置=(400, 300)
   节点3: 名称="食堂", 类型="食堂", 位置=(600, 300)
   节点4: 名称="宿舍", 类型="宿舍", 位置=(800, 300)
   ```

3. **创建道路**
   ```
   道路1: 东门 → 图书馆 (直线)
   道路2: 图书馆 → 食堂 (直线)
   道路3: 食堂 → 宿舍 (直线)
   ```

4. **保存地图**
   ```
   地图名称: "校园主干道"
   点击"💾 保存地图"
   ```

### 示例2：创建带折线的复杂道路

**场景**：创建一条从南门到北门的弯曲道路

1. **切换到创建边模式**
   ```
   点击"创建边"按钮
   ```

2. **创建折线道路**
   ```
   步骤1: 点击"南门"节点（起点）
   步骤2: 点击地图空白处 (300, 400) - 第1个折点
   步骤3: 点击地图空白处 (500, 300) - 第2个折点
   步骤4: 点击地图空白处 (700, 200) - 第3个折点
   步骤5: 点击"北门"节点（终点）
   完成: 系统自动计算道路长度
   ```

3. **取消正在创建的边**
   ```
   如果创建错误，点击"取消当前边"按钮重新开始
   ```

### 示例3：加载已保存的地图

1. **查看可用地图**
   ```
   点击"📂 加载地图"按钮
   系统显示所有已保存的地图列表
   ```

2. **选择地图**
   ```
   在弹出的对话框中输入地图名称
   如: "示例校园地图"
   点击确定
   ```

3. **查看加载结果**
   ```
   地图名称自动填充
   所有节点和边恢复显示
   可以继续编辑或查看
   ```

## 🎨 界面操作技巧

### 节点操作

#### 创建节点
```
模式: 创建节点
操作: 
  1. 填写节点名称（必填）
  2. 选择节点类型
  3. 点击地图上的目标位置
结果: 节点出现在点击位置，左侧列表更新
```

#### 查看节点信息
```
模式: 任意模式
操作: 鼠标悬停在节点上
结果: 节点放大，显示详细信息
```

#### 删除节点
```
模式: 删除模式
操作: 点击要删除的节点
结果: 节点及其相关的所有边被删除
警告: 此操作不可撤销！
```

### 边操作

#### 创建直线边
```
模式: 创建边
操作:
  1. 点击起始节点
  2. 直接点击结束节点
结果: 创建一条直线道路
```

#### 创建折线边
```
模式: 创建边
操作:
  1. 点击起始节点
  2. 点击地图空白处添加折点（可多次）
  3. 点击结束节点完成
结果: 创建一条弯曲道路
```

#### 查看边长度
```
模式: 任意模式
显示: 每条边的中点显示长度标签（单位：像素）
说明: 长度基于折线的总长度计算
```

#### 删除边
```
模式: 删除模式
操作: 点击边线（需要点击在边上）
结果: 边被删除，节点保留
```

### 地图操作

#### 清空地图
```
操作: 点击"🗑️ 清空地图"按钮
确认: 弹出确认对话框
结果: 所有节点和边被清空（背景图保留）
警告: 未保存的数据将丢失！
```

#### 切换查看模式
```
操作: 点击"查看"模式按钮
作用: 防止误操作，只能查看不能编辑
用途: 演示、检查、截图时使用
```

## 📊 数据统计

### 实时统计信息
```
位置: 画布右上角
显示内容:
  - 当前操作模式
  - 节点总数
  - 边总数
```

### 节点列表
```
位置: 左侧工具栏下方
显示内容:
  - 节点名称
  - 节点类型
  - 节点坐标
功能: 点击可查看详情（未来可实现）
```

### 边列表
```
位置: 左侧工具栏下方
显示内容:
  - 起点 → 终点
  - 道路长度
  - 折点数量
功能: 快速查看所有道路连接
```

## ⚡ 快捷操作

### 键盘快捷键（规划中）
```
Ctrl+S : 保存地图
Ctrl+Z : 撤销操作
Ctrl+Y : 重做操作
Delete : 删除选中元素
Esc    : 取消当前操作
```

### 鼠标操作
```
左键单击: 创建/选择元素
鼠标悬停: 显示详情
右键菜单: （规划中）快速操作
```

## 🎯 最佳实践

### 1. 节点命名规范
```
✅ 好的命名:
  - "东门"、"南门"
  - "主教学楼"、"实验楼A座"
  - "学生宿舍1号楼"
  - "充电站-停车场"

❌ 不好的命名:
  - "节点1"、"节点2"
  - "aaa"、"test"
  - "这里"、"那里"
```

### 2. 道路绘制技巧
```
直线道路:
  - 适用于笔直的主干道
  - 操作简单，创建快速

折线道路:
  - 适用于弯曲的道路
  - 更贴近实际路线
  - 建议3-5个折点为宜

注意事项:
  - 避免道路交叉重叠
  - 折点不要过于密集
  - 保持道路连续性
```

### 3. 地图保存策略
```
初始保存:
  - 创建基本结构后立即保存
  - 使用描述性的地图名称

增量保存:
  - 完成一个区域后保存
  - 重大修改前先保存

版本管理:
  - 使用不同名称保存多个版本
  - 如: "校园地图v1"、"校园地图v2"
```

## 🔍 调试技巧

### 查看浏览器控制台
```
操作: 按F12打开开发者工具
用途:
  - 查看API请求
  - 检查错误信息
  - 监控网络状态
```

### 测试API连接
```
URL: http://localhost:5000/api/node-types
预期: 返回节点类型列表JSON
说明: 用于测试后端是否正常运行
```

### 查看保存的数据
```
位置: backend/data/maps/*.json
工具: 任何文本编辑器
用途: 查看和调试地图数据结构
```

## 📈 性能优化建议

### 节点数量
```
建议: 20-50个节点
说明: 太多节点会影响渲染性能
方案: 将大地图分解为多个小地图
```

### 折点使用
```
建议: 每条边3-5个折点
说明: 过多折点影响计算效率
方案: 使用最少折点模拟真实路径
```

### 背景图片
```
建议: 分辨率1920x1080或更小
大小: 建议小于5MB
格式: PNG（透明） 或 JPG（压缩）
```

## 🐛 常见问题排查

### 问题1: 节点创建失败
```
检查: 是否填写节点名称
检查: 是否选择了"创建节点"模式
检查: 是否点击在画布内
```

### 问题2: 边创建失败
```
检查: 是否选择了"创建边"模式
检查: 是否先点击了起始节点
检查: 起点和终点是否为同一节点
```

### 问题3: 保存失败
```
检查: 是否填写地图名称
检查: 是否至少创建了一个节点
检查: 后端服务是否运行中
检查: 浏览器控制台的错误信息
```

## 📹 操作演示（文字版）

```
=== 完整操作流程演示 ===

1. 启动系统
   ./start.sh
   浏览器自动打开

2. 输入地图名称
   "天津大学示例地图"

3. 上传背景图
   选择 map.png
   等待加载完成

4. 创建节点（重复5次）
   东门 (大门) - 点击 (200, 400)
   图书馆 (图书馆) - 点击 (400, 300)
   食堂 (食堂) - 点击 (600, 300)
   教学楼 (教学楼) - 点击 (800, 200)
   宿舍 (宿舍) - 点击 (1000, 400)

5. 创建道路（切换到创建边模式）
   东门 → 图书馆
   图书馆 → 食堂
   食堂 → 教学楼
   教学楼 → 宿舍

6. 保存地图
   点击"💾 保存地图"
   等待成功提示

7. 验证保存
   刷新页面
   点击"📂 加载地图"
   输入"天津大学示例地图"
   确认数据恢复正确

完成！✅
```

---

**提示**: 这只是第一阶段功能，后续会添加更多高级特性！
